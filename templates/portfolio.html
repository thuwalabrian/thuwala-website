{% extends "base.html" %}

{% block title %}Our Portfolio - Thuwala Co.{% endblock %}

{% block content %}
<!-- Page Hero â€” Dark cinematic -->
<section class="relative py-32 lg:py-40 overflow-hidden dark-mesh-bg noise-overlay">
  <div class="orb orb-purple w-64 h-64 top-10 right-10"></div>
  <div class="orb orb-primary w-48 h-48 bottom-10 -left-10"></div>
  <div class="relative z-10 container mx-auto px-4">
    <div class="max-w-3xl">
      <span class="section-eyebrow text-purple-400 mb-4 block gsap-fade-in">Portfolio</span>
      <h1 class="text-4xl md:text-5xl lg:text-6xl xl:text-7xl font-black font-display text-white tracking-tight leading-[0.95] mb-6 gsap-fade-in">
        Our success<br><span class="gradient-text-animated">stories.</span>
      </h1>
      <p class="text-lg md:text-xl text-gray-400 leading-relaxed max-w-xl gsap-fade-in">
        See how we've helped organizations achieve efficiency, precision, and excellence.
      </p>
    </div>
    
    <div class="separator-gradient mt-12 mb-0"></div>
    <div class="grid grid-cols-3 gap-8 pt-8 gsap-fade-in">
      <div class="text-center lg:text-left">
        <div class="stat-number text-3xl md:text-4xl font-black text-white" x-data="{ count: 0 }" x-intersect.once="let i = setInterval(() => { count++; if(count >= 50) clearInterval(i) }, 30)">
          <span x-text="count"></span><span class="text-blue-400">+</span>
        </div>
        <p class="text-gray-500 text-sm mt-1 font-medium">Projects completed</p>
      </div>
      <div class="text-center">
        <div class="stat-number text-3xl md:text-4xl font-black text-white" x-data="{ count: 0 }" x-intersect.once="let i = setInterval(() => { count++; if(count >= 45) clearInterval(i) }, 30)">
          <span x-text="count"></span><span class="text-emerald-400">+</span>
        </div>
        <p class="text-gray-500 text-sm mt-1 font-medium">Satisfied clients</p>
      </div>
      <div class="text-center lg:text-right">
        <div class="stat-number text-3xl md:text-4xl font-black text-white" x-data="{ count: 0 }" x-intersect.once="let i = setInterval(() => { count++; if(count >= 60) clearInterval(i) }, 20)">
          <span x-text="count"></span><span class="text-purple-400">%</span>
        </div>
        <p class="text-gray-500 text-sm mt-1 font-medium">Avg efficiency gain</p>
      </div>
    </div>
  </div>
</section>

<!-- Filter & Portfolio Grid -->
<section class="py-20 lg:py-32 bg-white">
  <div class="container mx-auto px-4">
    <!-- Category Filter -->
    <div class="mb-12 flex flex-wrap justify-center gap-3">
      <a href="{{ url_for('portfolio', category='all') }}" class="filter-btn {% if current_category == 'all' %}bg-primary text-white shadow-lg{% else %}bg-gray-100 text-gray-900 hover:bg-gray-200{% endif %} px-6 py-2.5 rounded-full font-semibold transition-all duration-300">
        All Projects
      </a>
      {% for category in categories %}
      <a href="{{ url_for('portfolio', category=category) }}" class="filter-btn {% if current_category == category %}bg-primary text-white shadow-lg{% else %}bg-gray-100 text-gray-900 hover:bg-gray-200{% endif %} px-6 py-2.5 rounded-full font-semibold transition-all duration-300">
        {{ category | title }}
      </a>
      {% endfor %}
    </div>

    <!-- Portfolio Grid -->
    {% if portfolio_items %}
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
      {% for item in portfolio_items %}
      <article class="group relative bg-white rounded-xl overflow-hidden border border-gray-100 shadow-sm hover:shadow-xl transition-all duration-500 hover:-translate-y-3" data-category="{{ item.category }}" data-featured="{{ 'true' if item.featured else 'false' }}">
        

        <!-- Image Container -->
        <div class="relative h-48 overflow-hidden bg-gradient-to-br from-gray-200 to-gray-300">
          {% if item.image_url %}
          <img src="{{ item.image_url }}" alt="{{ item.title }}" loading="lazy" decoding="async" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500">
          {% else %}
          <div class="w-full h-full flex items-center justify-center">
            <i class="fas fa-image text-gray-400 text-4xl"></i>
          </div>
          {% endif %}
          
          <!-- Featured Badge -->
          {% if item.featured %}
          <div class="absolute top-4 right-4 inline-flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-primary to-secondary text-white text-xs font-bold rounded-full shadow-lg">
            <i class="fas fa-star text-xs"></i>
            Featured
          </div>
          {% endif %}
        </div>

        <!-- Content -->
        <div class="p-6 space-y-4">
          <!-- Category Badge -->
          <div class="flex items-center gap-2">
            <span class="px-2.5 py-1 bg-primary/10 text-primary text-xs font-semibold rounded-full">
              {{ item.category | title }}
            </span>
          </div>

          <!-- Title -->
          <h3 class="text-xl font-bold text-gray-900 group-hover:text-primary transition-colors duration-300">
            {{ item.title }}
          </h3>

          <!-- Client -->
          <p class="text-sm text-gray-500 flex items-center gap-2">
            <i class="fas fa-building text-primary/50"></i>
            {{ item.client }}
          </p>

          <!-- Description -->
          <p class="text-gray-500 text-sm line-clamp-2">
            {{ item.description }}
          </p>

          <!-- View Details Button -->
          <button type="button" class="view-details w-full mt-4 px-4 py-2.5 bg-gradient-to-r from-primary to-secondary text-white font-semibold rounded-lg hover:shadow-lg hover:-translate-y-0.5 transition-all duration-300" data-id="{{ item.id }}">
            <i class="fas fa-arrow-right mr-2"></i> View Details
          </button>
        </div>
      </article>
      {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-20">
      <i class="fas fa-inbox text-6xl text-gray-300 mb-4"></i>
      <h3 class="text-2xl font-bold text-gray-900 mb-2">No projects found</h3>
      <p class="text-gray-500">We're working on some amazing projects. Check back soon!</p>
    </div>
    {% endif %}
  </div>
</section>

<!-- Portfolio Details Modal -->
<div id="portfolioModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4" aria-hidden="true" role="dialog">
  <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
    <!-- Modal Header -->
    <div class="sticky top-0 bg-gradient-to-r from-primary to-secondary p-6 flex items-center justify-between">
      <h2 class="text-2xl font-bold text-white">Project Details</h2>
      <button type="button" class="close-modal text-white hover:text-gray-200 transition-colors duration-300 text-2xl" aria-label="Close modal">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <!-- Modal Content -->
    <div id="modalContent" class="p-8 space-y-6">
      <!-- Content will be populated by JavaScript -->
    </div>
  </div>
</div>

<!-- Embed Portfolio Data for Modal -->
<script>
  window.portfolioDetails = {
    {% for item in portfolio_items %}
    "{{ item.id }}": {
      title: "{{ item.title }}",
      client: "{{ item.client }}",
      description: `{{ item.description | replace('"', '\\"') }}`,
      category: "{{ item.category }}",
      technologies: "{{ item.technologies }}",
      testimonial: `{{ item.testimonial | replace('"', '\\"') }}`,
      client_name: "{{ item.client_name }}",
      client_role: "{{ item.client_role }}",
      featured: {{ 'true' if item.featured else 'false' }}
    }{{ "," if not loop.last else "" }}
    {% endfor %}
  };

  document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('portfolioModal');
    const closeBtn = modal.querySelector('.close-modal');
    const modalContent = document.getElementById('modalContent');
    const viewButtons = document.querySelectorAll('.view-details');

    // View details button click
    viewButtons.forEach(button => {
      button.addEventListener('click', function() {
        const itemId = this.getAttribute('data-id');
        const details = window.portfolioDetails[itemId];

        if (details) {
          modalContent.innerHTML = `
            <div class="space-y-6">
              <!-- Title & Category -->
              <div>
                <h3 class="text-3xl font-bold text-gray-900 mb-2">${details.title}</h3>
                <span class="inline-block px-3 py-1 bg-primary/10 text-primary font-semibold rounded-full text-sm">
                  ${details.category.charAt(0).toUpperCase() + details.category.slice(1)}
                </span>
              </div>

              <!-- Client Info -->
              <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                <h4 class="font-semibold text-gray-900 mb-2 flex items-center gap-2">
                  <i class="fas fa-building text-primary"></i> Client
                </h4>
                <p class="text-gray-900">${details.client}</p>
              </div>

              <!-- Project Description -->
              <div>
                <h4 class="font-semibold text-gray-900 mb-2 flex items-center gap-2">
                  <i class="fas fa-info-circle text-primary"></i> Project Overview
                </h4>
                <p class="text-gray-900 leading-relaxed">${details.description}</p>
              </div>

              <!-- Technologies -->
              <div>
                <h4 class="font-semibold text-gray-900 mb-3 flex items-center gap-2">
                  <i class="fas fa-tools text-primary"></i> Technologies & Tools
                </h4>
                <div class="flex flex-wrap gap-2">
                  ${details.technologies.split(',').map(tech => 
                    \`<span class="px-3 py-1.5 bg-gradient-to-r from-primary/10 to-secondary/10 text-primary font-semibold rounded-lg text-sm border border-primary/20">\${tech.trim()}</span>\`
                  ).join('')}
                </div>
              </div>

              ${details.testimonial ? \`
              <!-- Testimonial -->
              <div class="bg-gradient-to-br from-primary/5 to-secondary/5 rounded-lg p-6 border border-primary/10">
                <div class="flex gap-3 mb-3">
                  <i class="fas fa-quote-left text-primary text-xl"></i>
                </div>
                <p class="text-gray-900 italic mb-4 leading-relaxed">"\${details.testimonial}"</p>
                <div class="pt-4 border-t border-primary/20">
                  <p class="font-semibold text-gray-900">\${details.client_name}</p>
                  <p class="text-sm text-gray-900">\${details.client_role}</p>
                </div>
              </div>
              \` : ''}

              <!-- CTA -->
              <a href="{{ url_for('contact') }}" class="inline-block w-full px-6 py-3 bg-gradient-to-r from-primary to-secondary text-white font-semibold rounded-lg hover:shadow-lg hover:-translate-y-0.5 transition-all duration-300 text-center">
                <i class="fas fa-handshake mr-2"></i> Start Similar Project
              </a>
            </div>
          `;

          modal.classList.remove('hidden');
          modal.setAttribute('aria-hidden', 'false');
          document.body.style.overflow = 'hidden';
          closeBtn.focus();
        }
      });
    });

    // Close modal
    closeBtn.addEventListener('click', function() {
      modal.classList.add('hidden');
      modal.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = 'auto';
    });

    // Close when clicking outside
    window.addEventListener('click', function(e) {
      if (e.target === modal) {
        modal.classList.add('hidden');
        modal.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = 'auto';
      }
    });

    // Close with Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
        modal.classList.add('hidden');
        modal.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = 'auto';
      }
    });

    // Counter animation
    const counters = document.querySelectorAll('.counter');
    const counterObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const target = parseInt(entry.target.getAttribute('data-target'));
          animateCounter(entry.target, target);
          counterObserver.unobserve(entry.target);
        }
      });
    }, { threshold: 0.5 });

    counters.forEach(counter => counterObserver.observe(counter));

    function animateCounter(element, target, duration = 2000) {
      let start = 0;
      const increment = target / (duration / 16);
      const timer = setInterval(() => {
        start += increment;
        if (start >= target) {
          element.textContent = target + '+';
          clearInterval(timer);
        } else {
          element.textContent = Math.floor(start);
        }
      }, 16);
    }

    // Category filtering
    const filterButtons = document.querySelectorAll('.filter-btn');
    const portfolioCards = document.querySelectorAll('article[data-category]');

    filterButtons.forEach(btn => {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        filterButtons.forEach(b => b.classList.remove('bg-primary', 'text-white', 'shadow-lg'));
        filterButtons.forEach(b => b.classList.add('bg-gray-100', 'text-gray-900'));
        this.classList.remove('bg-gray-100', 'text-gray-900');
        this.classList.add('bg-primary', 'text-white', 'shadow-lg');

        const category = new URL(this.href).searchParams.get('category') || 'all';
        portfolioCards.forEach(card => {
          const cardCat = (card.getAttribute('data-category') || '').toLowerCase();
          const matches = (category === 'all') || (cardCat === category.toLowerCase());
          card.style.display = matches ? '' : 'none';
        });
      });
    });
  });
</script>
{% endblock %}
