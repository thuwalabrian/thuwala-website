{% extends "base.html" %}

{% block title %}{{ 'Edit' if portfolio else 'Add' }} Portfolio - Admin Dashboard{% endblock %}

{% block content %}
<div class="admin-container">
    <!-- Sidebar -->
    <aside class="admin-sidebar" id="adminSidebar">
        <div class="sidebar-header">
            <h1>Thuwala Admin</h1>
            <p>Portfolio Management</p>
        </div>
        
        <div class="sidebar-user">
            <div class="user-avatar">
                {{ current_user.username[0]|upper }}
            </div>
            <div class="user-info">
                <h3>{{ current_user.username }}</h3>
                <p>Administrator</p>
            </div>
        </div>
        
        <nav class="sidebar-nav">
            <div class="nav-section">
                <h3>Main</h3>
                <a href="{{ url_for('admin_dashboard') }}" 
                   class="nav-item {% if request.endpoint == 'admin_dashboard' %}active{% endif %}">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
            </div>
            
            <div class="nav-section">
                <h3>Content Management</h3>
                <a href="{{ url_for('admin_services') }}" 
                   class="nav-item {% if request.endpoint == 'admin_services' %}active{% endif %}">
                    <i class="fas fa-cogs"></i>
                    <span>Services</span>
                </a>
                <a href="{{ url_for('admin_portfolio') }}" 
                   class="nav-item {% if request.endpoint == 'admin_portfolio' %}active{% endif %}">
                    <i class="fas fa-briefcase"></i>
                    <span>Portfolio</span>
                </a>
            </div>
            
            <div class="nav-section">
                <h3>System</h3>
                <a href="{{ url_for('admin_users') }}" 
                   class="nav-item {% if request.endpoint == 'admin_users' %}active{% endif %}">
                    <i class="fas fa-users"></i>
                    <span>Users</span>
                </a>
                <a href="{{ url_for('change_password') }}" class="nav-item">
                    <i class="fas fa-key"></i>
                    <span>Change Password</span>
                </a>
            </div>
        </nav>
        
        <div class="sidebar-footer">
            <a href="{{ url_for('admin_logout') }}" class="btn btn-danger btn-sm">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">
        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" id="mobileMenuToggle">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Header -->
        <header class="admin-header">
            <div class="header-title">
                <h1>{{ 'Edit Portfolio Item' if portfolio else 'Add New Portfolio Item' }}</h1>
                <p>{{ 'Update project details' if portfolio else 'Showcase your work with a new portfolio item' }}</p>
            </div>
            <div class="header-actions">
                <a href="{{ url_for('admin_portfolio') }}" class="header-btn">
                    <i class="fas fa-arrow-left"></i> Back to Portfolio
                </a>
            </div>
        </header>

        <!-- Form Container -->
        <div class="form-container">
            <div class="form-layout">
                <!-- Left Column: Form -->
                <div class="form-column">
                    <form method="POST" class="modern-form" enctype="multipart/form-data">
                        <!-- Basic Information Card -->
                        <div class="form-card">
                            <div class="form-card-header">
                                <h2><i class="fas fa-info-circle"></i> Basic Information</h2>
                                <p class="form-card-subtitle">Required project details</p>
                            </div>
                            <div class="form-card-body">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="title" class="form-label">
                                            <i class="fas fa-heading"></i> Project Title *
                                        </label>
                                        <input type="text" 
                                               id="title" 
                                               name="title" 
                                               value="{{ portfolio.title if portfolio else '' }}" 
                                               required 
                                               class="form-input"
                                               placeholder="e.g., Malawi NGO Data Dashboard"
                                               data-preview="title">
                                        <div class="form-hint">Keep it concise and descriptive</div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="client" class="form-label">
                                            <i class="fas fa-building"></i> Client Name *
                                        </label>
                                        <input type="text" 
                                               id="client" 
                                               name="client" 
                                               value="{{ portfolio.client if portfolio else '' }}" 
                                               required 
                                               class="form-input"
                                               placeholder="e.g., Malawi Development NGO"
                                               data-preview="client">
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="category" class="form-label">
                                            <i class="fas fa-tag"></i> Category *
                                        </label>
                                        <select id="category" name="category" required class="form-select" data-preview="category">
                                            <option value="">Select a category</option>
                                            {% for cat in categories %}
                                            <option value="{{ cat }}" 
                                                    {% if portfolio and portfolio.category == cat %}selected{% endif %}>
                                                {{ cat|title }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="project_url" class="form-label">
                                            <i class="fas fa-link"></i> Project URL
                                        </label>
                                        <input type="url" 
                                               id="project_url" 
                                               name="project_url" 
                                               value="{{ portfolio.project_url if portfolio else '' }}" 
                                               class="form-input"
                                               placeholder="https://example.com">
                                        <div class="form-hint">Optional - live project link</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Project Details Card -->
                        <div class="form-card">
                            <div class="form-card-header">
                                <h2><i class="fas fa-file-alt"></i> Project Details</h2>
                                <p class="form-card-subtitle">Describe the project and technologies used</p>
                            </div>
                            <div class="form-card-body">
                                <div class="form-group">
                                    <label for="description" class="form-label">
                                        <i class="fas fa-align-left"></i> Project Description *
                                    </label>
                                    <textarea id="description" 
                                              name="description" 
                                              rows="6" 
                                              required 
                                              class="form-textarea"
                                              placeholder="Describe the project scope, challenges faced, solutions implemented, and outcomes achieved..."
                                              data-preview="description">{{ portfolio.description if portfolio else '' }}</textarea>
                                    <div class="form-hint">Detailed description helps showcase your expertise</div>
                                </div>

                                <div class="form-group">
                                    <label for="technologies" class="form-label">
                                        <i class="fas fa-code"></i> Technologies Used
                                    </label>
                                    <div class="tags-input-container">
                                        <input type="text" 
                                               id="technologies" 
                                               name="technologies" 
                                               value="{{ portfolio.technologies if portfolio else '' }}" 
                                               class="form-input"
                                               placeholder="Enter technology and press comma"
                                               data-preview="technologies">
                                        <div class="tags-hint">Separate with commas (e.g., Python, React, MySQL)</div>
                                        <div class="tags-preview" id="tagsPreview"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Media & Featured Card -->
                        <div class="form-card">
                            <div class="form-card-header">
                                <h2><i class="fas fa-image"></i> Media & Display</h2>
                                <p class="form-card-subtitle">Project image and visibility settings</p>
                            </div>
                            <div class="form-card-body">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="image_url" class="form-label">
                                            <i class="fas fa-globe"></i> Image URL
                                        </label>
                                        <input type="url" 
                                               id="image_url" 
                                               name="image_url" 
                                               value="{{ portfolio.image_url if portfolio else '' }}" 
                                               class="form-input"
                                               placeholder="https://images.unsplash.com/photo-..."
                                               data-preview="image">
                                        <div class="form-hint">Direct link to project image</div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="image_file" class="form-label">
                                            <i class="fas fa-upload"></i> Upload Image
                                        </label>
                                        <div class="file-upload">
                                            <input type="file" 
                                                   id="image_file" 
                                                   name="image_file" 
                                                   accept="image/*"
                                                   class="file-input"
                                                   data-preview="image">
                                            <label for="image_file" class="file-label">
                                                <i class="fas fa-cloud-upload-alt"></i>
                                                <span>Choose File</span>
                                            </label>
                                            <div class="file-info" id="fileInfo">No file chosen</div>
                                        </div>
                                        <div class="form-hint">Max 5MB. JPG, PNG, or WebP recommended</div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="checkbox-group">
                                        <input type="checkbox" 
                                               id="featured" 
                                               name="featured" 
                                               value="1"
                                               {% if portfolio and portfolio.featured %}checked{% endif %}
                                               class="checkbox-input"
                                               data-preview="featured">
                                        <label for="featured" class="checkbox-label">
                                            <div class="checkbox-box">
                                                <i class="fas fa-check"></i>
                                            </div>
                                            <div class="checkbox-content">
                                                <span class="checkbox-title">Featured Project</span>
                                                <span class="checkbox-description">Highlight this project on the portfolio page</span>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Testimonial Card -->
                        <div class="form-card">
                            <div class="form-card-header">
                                <h2><i class="fas fa-comment-dots"></i> Client Testimonial</h2>
                                <p class="form-card-subtitle">Optional client feedback</p>
                            </div>
                            <div class="form-card-body">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="client_name" class="form-label">
                                            <i class="fas fa-user"></i> Client Name
                                        </label>
                                        <input type="text" 
                                               id="client_name" 
                                               name="client_name" 
                                               value="{{ portfolio.client_name if portfolio else '' }}" 
                                               class="form-input"
                                               placeholder="John Banda">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="client_role" class="form-label">
                                            <i class="fas fa-briefcase"></i> Client Role
                                        </label>
                                        <input type="text" 
                                               id="client_role" 
                                               name="client_role" 
                                               value="{{ portfolio.client_role if portfolio else '' }}" 
                                               class="form-input"
                                               placeholder="M&E Director">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="testimonial" class="form-label">
                                        <i class="fas fa-quote-left"></i> Testimonial Text
                                    </label>
                                    <textarea id="testimonial" 
                                              name="testimonial" 
                                              rows="4" 
                                              class="form-textarea"
                                              placeholder="Client's feedback about the project, results achieved, and working experience...">{{ portfolio.testimonial if portfolio else '' }}</textarea>
                                    <div class="form-hint">Short and impactful testimonials work best</div>
                                </div>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-save"></i> {{ 'Update Project' if portfolio else 'Add Project' }}
                            </button>
                            <a href="{{ url_for('admin_portfolio') }}" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Cancel
                            </a>
                            {% if portfolio %}
                            <a href="{{ url_for('delete_portfolio', portfolio_id=portfolio.id) }}" 
                               class="btn btn-danger ml-auto"
                               onclick="return confirm('Are you sure you want to delete this portfolio item?')">
                                <i class="fas fa-trash"></i> Delete
                            </a>
                            {% endif %}
                        </div>
                    </form>
                </div>

                <!-- Right Column: Preview -->
                <div class="preview-column">
                    <div class="preview-card">
                        <div class="preview-card-header">
                            <h3><i class="fas fa-eye"></i> Live Preview</h3>
                            <p>See how your project will appear</p>
                        </div>
                        
                        <div class="preview-content">
                            <!-- Project Image -->
                            <div class="preview-image-container">
                                <img id="previewImage" 
                                     src="{{ portfolio.image_url if portfolio and portfolio.image_url else 'https://images.unsplash.com/photo-1552664730-d307ca884978?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80' }}" 
                                     alt="Project preview"
                                     class="preview-image">
                                <div class="image-overlay">
                                    <span id="previewCategory" class="category-badge">
                                        {{ portfolio.category|title if portfolio else 'Category' }}
                                    </span>
                                    <span id="previewFeatured" class="featured-badge" style="display: {{ 'flex' if portfolio and portfolio.featured else 'none' }}">
                                        <i class="fas fa-star"></i> Featured
                                    </span>
                                </div>
                            </div>
                            
                            <!-- Project Details -->
                            <div class="preview-details">
                                <h4 id="previewTitle">{{ portfolio.title if portfolio else 'Project Title' }}</h4>
                                <div class="preview-meta">
                                    <span class="meta-item">
                                        <i class="fas fa-building"></i>
                                        <span id="previewClient">{{ portfolio.client if portfolio else 'Client Name' }}</span>
                                    </span>
                                    {% if portfolio and portfolio.project_url %}
                                    <a href="{{ portfolio.project_url }}" class="meta-item" target="_blank">
                                        <i class="fas fa-external-link-alt"></i>
                                        <span>View Project</span>
                                    </a>
                                    {% endif %}
                                </div>
                                
                                <div class="preview-description">
                                    <p id="previewDescription">
                                        {{ portfolio.description[:150] + '...' if portfolio and portfolio.description else 'Project description will appear here...' }}
                                    </p>
                                </div>
                                
                                <!-- Technologies -->
                                <div class="preview-technologies">
                                    <h5><i class="fas fa-code"></i> Technologies</h5>
                                    <div class="tech-tags" id="previewTech">
                                        {% if portfolio and portfolio.technologies %}
                                            {% for tech in portfolio.technologies.split(',')[:5] %}
                                            <span class="tech-tag">{{ tech.strip() }}</span>
                                            {% endfor %}
                                            {% if portfolio.technologies.split(',')|length > 5 %}
                                            <span class="tech-tag">+{{ portfolio.technologies.split(',')|length - 5 }}</span>
                                            {% endif %}
                                        {% else %}
                                            <span class="tech-tag placeholder">Technology</span>
                                            <span class="tech-tag placeholder">Tools</span>
                                            <span class="tech-tag placeholder">Platform</span>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <!-- Testimonial Preview -->
                                {% if portfolio and portfolio.testimonial %}
                                <div class="preview-testimonial">
                                    <div class="testimonial-quote">
                                        <i class="fas fa-quote-left"></i>
                                        <p>"{{ portfolio.testimonial[:120] }}{% if portfolio.testimonial|length > 120 %}...{% endif %}"</p>
                                    </div>
                                    <div class="testimonial-author">
                                        <strong>{{ portfolio.client_name }}</strong>
                                        <span>{{ portfolio.client_role }}</span>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Image Tips -->
                        <div class="preview-tips">
                            <h4><i class="fas fa-lightbulb"></i> Image Guidelines</h4>
                            <ul class="tips-list">
                                <li><i class="fas fa-check-circle"></i> Optimal size: 1200Ã—800px (3:2 ratio)</li>
                                <li><i class="fas fa-check-circle"></i> File size: under 500KB</li>
                                <li><i class="fas fa-check-circle"></i> Formats: JPG, PNG, WebP</li>
                                <li><i class="fas fa-check-circle"></i> Clear, professional images work best</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<script>
// This function will be handled by admin.js
document.addEventListener('DOMContentLoaded', function() {
    // Admin.js handles the initialization
});
</script>
{% endblock %}