{% extends "base.html" %}

{% block title %}Admin Dashboard - Thuwala Co.{% endblock %}

{% block content %}
<div class="admin-container">
    <!-- Sidebar -->
    <aside class="admin-sidebar" id="adminSidebar">
        <div class="sidebar-header">
            <h1>Thuwala Admin</h1>
            <p>Dashboard Control Panel</p>
        </div>
        
        <div class="sidebar-user">
            <div class="user-avatar">
                {{ current_user.username[0]|upper }}
            </div>
            <div class="user-info">
                <h3>{{ current_user.username }}</h3>
                <p>Administrator</p>
            </div>
        </div>
        
        <nav class="sidebar-nav">
            <div class="nav-section">
                <h3>Main</h3>
                <a href="{{ url_for('admin_dashboard') }}" 
                   class="nav-item {% if request.endpoint == 'admin_dashboard' %}active{% endif %}">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
            </div>
            
            <div class="nav-section">
                <h3>Content Management</h3>
                <a href="{{ url_for('admin_services') }}" 
                   class="nav-item {% if request.endpoint == 'admin_services' %}active{% endif %}">
                    <i class="fas fa-cogs"></i>
                    <span>Services</span>
                </a>
                <a href="{{ url_for('admin_portfolio') }}" 
                   class="nav-item {% if request.endpoint == 'admin_portfolio' %}active{% endif %}">
                    <i class="fas fa-briefcase"></i>
                    <span>Portfolio</span>
                </a>
                <a href="{{ url_for('admin_advertisements') }}" 
                   class="nav-item {% if request.endpoint in ['admin_advertisements', 'add_advertisement', 'edit_advertisement'] %}active{% endif %}">
                    <i class="fas fa-ad"></i>
                    <span>Advertisements</span>
                </a>
            </div>
            
            <div class="nav-section">
                <h3>System</h3>
                <a href="{{ url_for('admin_users') }}" 
                   class="nav-item {% if request.endpoint == 'admin_users' %}active{% endif %}">
                    <i class="fas fa-users"></i>
                    <span>Users</span>
                </a>
                <a href="{{ url_for('change_password') }}" class="nav-item">
                    <i class="fas fa-key"></i>
                    <span>Change Password</span>
                </a>
            </div>
            
        </nav>
        
        <div class="sidebar-footer">
            <a href="{{ url_for('admin_logout') }}" class="btn btn-danger btn-sm">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">
        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" id="mobileMenuToggle">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Header -->
        <header class="admin-header">
            <div class="header-title">
                <h1>Dashboard Overview</h1>
                <p>Welcome back, {{ current_user.username }}! Here's what's happening today.</p>
            </div>
            <div class="header-actions">
                <a href="{{ url_for('change_password') }}" class="header-btn">
                    <i class="fas fa-key"></i> Password
                </a>
                <a href="{{ url_for('admin_logout') }}" class="header-btn logout-btn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </div>
        </header>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon blue">
                    <i class="fas fa-cogs"></i>
                </div>
                <div class="stat-content">
                    <h3 class="stat-number">{{ service_count|default(0) }}</h3>
                    <p class="stat-label">Active Services</p>
                </div>
                <a href="{{ url_for('admin_services') }}" class="stat-link">
                    <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon purple">
                    <i class="fas fa-briefcase"></i>
                </div>
                <div class="stat-content">
                    <h3 class="stat-number">{{ portfolio_count|default(0) }}</h3>
                    <p class="stat-label">Portfolio Items</p>
                </div>
                <a href="{{ url_for('admin_portfolio') }}" class="stat-link">
                    <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon green">
                    <i class="fas fa-envelope"></i>
                </div>
                <div class="stat-content">
                    <h3 class="stat-number">{{ messages|length|default(0) }}</h3>
                    <p class="stat-label">Total Messages</p>
                </div>
                <a href="#view-all-messages" class="stat-link">
                    <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon red">
                    <i class="fas fa-user-shield"></i>
                </div>
                <div class="stat-content">
                    <h3 class="stat-number">{{ user_count|default(1) }}</h3>
                    <p class="stat-label">Admin Users</p>
                </div>
                <a href="{{ url_for('admin_users') }}" class="stat-link">
                    <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="content-grid">
            <!-- Left Column -->
            <div class="main-column">
                <!-- Quick Actions -->
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-bolt"></i> Quick Actions</h2>
                    </div>
                    <div class="card-body">
                        <div class="actions-grid">
                            <a href="{{ url_for('add_service') }}" class="action-item">
                                <div class="action-icon blue">
                                    <i class="fas fa-plus"></i>
                                </div>
                                <div>
                                    <h4>Add Service</h4>
                                    <p>Create new service offering</p>
                                </div>
                            </a>
                            
                            <a href="{{ url_for('add_portfolio') }}" class="action-item">
                                <div class="action-icon purple">
                                    <i class="fas fa-plus"></i>
                                </div>
                                <div>
                                    <h4>Add Portfolio</h4>
                                    <p>Showcase new projects</p>
                                </div>
                            </a>
                            
                            <a href="{{ url_for('admin_services') }}" class="action-item">
                                <div class="action-icon green">
                                    <i class="fas fa-edit"></i>
                                </div>
                                <div>
                                    <h4>Manage Services</h4>
                                    <p>Edit existing services</p>
                                </div>
                            </a>
                            
                            <a href="{{ url_for('admin_portfolio') }}" class="action-item">
                                <div class="action-icon amber">
                                    <i class="fas fa-edit"></i>
                                </div>
                                <div>
                                    <h4>Manage Portfolio</h4>
                                    <p>Edit portfolio items</p>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Recent Messages -->
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-envelope"></i> Recent Messages</h2>
                        <div class="header-badges">
                            {% if unread_count > 0 %}
                            <span class="badge unread-badge">{{ unread_count }} Unread</span>
                            {% endif %}
                            <a href="#view-all" class="btn-text">View All â†’</a>
                        </div>
                    </div>
                    <div class="card-body">
                        {% if messages %}
                        <div class="messages-list">
                            {% for msg in messages[:5] %}
                            <div class="message-item {% if not msg.is_read %}unread{% endif %}">
                                <div class="message-avatar">
                                    {{ msg.name[0]|upper }}
                                </div>
                                <div class="message-content">
                                    <div class="message-header">
                                        <h4>{{ msg.name }}</h4>
                                        <span class="message-time">{{ msg.created_at.strftime('%I:%M %p') }}</span>
                                    </div>
                                    <p class="message-preview">{{ msg.subject or 'No Subject' }}</p>
                                    <div class="message-actions">
                                        <button class="btn btn-sm btn-primary" onclick="viewMessage({{ msg.id }})">
                                            <i class="fas fa-eye"></i> View
                                        </button>
                                        {% if not msg.is_read %}
                                        <a href="{{ url_for('mark_message_read', message_id=msg.id) }}" 
                                           class="btn btn-sm btn-success"
                                           onclick="return confirm('Mark as read?')">
                                            <i class="fas fa-check"></i> Mark Read
                                        </a>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="empty-state">
                            <i class="fas fa-comments"></i>
                            <h3>No messages yet</h3>
                            <p>Contact messages will appear here</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="sidebar-column">
                <!-- System Status -->
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-heartbeat"></i> System Status</h2>
                    </div>
                    <div class="card-body">
                        <div class="status-list">
                            <div class="status-item online">
                                <div class="status-indicator"></div>
                                <span>Website Status</span>
                                <span class="status-value">Online</span>
                            </div>
                            <div class="status-item online">
                                <div class="status-indicator"></div>
                                <span>Database</span>
                                <span class="status-value">Connected</span>
                            </div>
                            <div class="status-item online">
                                <div class="status-indicator"></div>
                                <span>Storage</span>
                                <span class="status-value">Healthy</span>
                            </div>
                            <div class="status-item online">
                                <div class="status-indicator"></div>
                                <span>Messages Today</span>
                                <span class="status-value">{{ unread_count|default(0) }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-chart-line"></i> Recent Activity</h2>
                    </div>
                    <div class="card-body">
                        <div class="activity-list">
                            <div class="activity-item">
                                <div class="activity-icon blue">
                                    <i class="fas fa-cogs"></i>
                                </div>
                                <div class="activity-info">
                                    <h4>{{ service_count|default(0) }} Services</h4>
                                    <p>Currently active</p>
                                </div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-icon green">
                                    <i class="fas fa-briefcase"></i>
                                </div>
                                <div class="activity-info">
                                    <h4>{{ portfolio_count|default(0) }} Projects</h4>
                                    <p>In portfolio</p>
                                </div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-icon orange">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="activity-info">
                                    <h4>{{ user_count|default(1) }} Users</h4>
                                    <p>With admin access</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Message Modal -->
<div class="modal-overlay" id="messageModalOverlay">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Message Details</h2>
            <button class="modal-close" onclick="closeModal(this.closest('.modal-overlay'))">&times;</button>
        </div>
        <div class="modal-body" id="messageModalContent">
            <!-- Message content will be loaded here -->
        </div>
    </div>
</div>
{% endblock %}