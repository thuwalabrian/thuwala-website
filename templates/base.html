<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Thuwala Co. - Efficiency. Precision. Excellence.{% endblock %}</title>
    
    <!-- Favicon Configuration -->
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='images/logo/logo-180x180.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='images/logo/logo-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='images/logo/logo-16x16.png') }}">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/logo/favicon.ico') }}">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#2563eb">
    <meta name="msapplication-TileColor" content="#2563eb">
    <meta name="msapplication-TileImage" content="{{ url_for('static', filename='images/logo/logo-192x192.png') }}">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Thuwala Co. provides comprehensive business solutions with efficiency, precision, and excellence. Based in Lilongwe, Malawi.">
    <meta name="keywords" content="business services, administration, project support, data analytics, branding, Malawi, Lilongwe">
    <meta name="author" content="Thuwala Co.">
    
    <!-- Open Graph for Social Media -->
    <meta property="og:title" content="Thuwala Co. - Efficiency. Precision. Excellence.">
    <meta property="og:description" content="Comprehensive business solutions in Malawi">
    <meta property="og:image" content="{{ url_for('static', filename='images/logo/logo-512x512.png', _external=True) }}">
    <meta property="og:url" content="{{ request.url_root }}">
    <meta property="og:type" content="website">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Thuwala Co. - Efficiency. Precision. Excellence.">
    <meta name="twitter:description" content="Comprehensive business solutions in Malawi">
    <meta name="twitter:image" content="{{ url_for('static', filename='images/logo/logo-512x512.png', _external=True) }}">
    
    <!-- ðŸš€ Modern CSS Frameworks -->
    <!-- Performance: preconnect to CDNs -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://unpkg.com" crossorigin>
    
    <!-- Splide.js - Modern Carousel/Slider -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/css/splide.min.css">
    
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Google Fonts (optimized preconnect) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Custom CSS Files - Load order critical -->
    <!-- Tailwind CSS CDN (full utility palette for all pages) -->
    <script src="https://cdn.tailwindcss.com?v=3.4.19"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb',
                        secondary: '#10b981'
                    },
                    fontFamily: {
                        display: ['Poppins', 'sans-serif'],
                        body: ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=20260215">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}?v=20260215">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/splide-theme.css') }}?v=20260215">
    
    <!-- CSRF Token for form protection -->
    <meta name="csrf-token" content="{{ csrf_token() }}">
    
    <!-- Admin CSS (only loads on admin pages) -->
    {% if request.path.startswith('/admin') %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}?v=20260210">
    {% endif %}
    
    {% block head %}{% endblock %}
    
    <!-- Alpine.js cloak + Modern utilities + AOS fallback -->
    <style>
      [x-cloak]{display:none!important}
      html{scroll-behavior:smooth;}
    </style>
</head>
<body>
    <!-- Skip link for keyboard users -->
    <a class="skip-link" href="#main-content">Skip to content</a>
    <!-- Only show main site navigation on non-admin pages -->
    {% if not request.path.startswith('/admin') %}
    <!-- Navigation (Alpine.js) -->
    <nav x-data="{ open: false }" @click.outside="open = false" class="navbar">
        <div class="container">
            <a href="{{ url_for('index') }}" class="logo">
                 <img src="{{ url_for('static', filename='images/logo/logo-512x512.png') }}" 
                     alt="Thuwala Co. Logo - Efficiency. Precision. Excellence."
                     class="logo-image"
                     width="180"
                     height="60"
                     loading="eager"
                     decoding="async"
                     fetchpriority="high">
            </a>

            <div class="nav-menu" id="navMenu" :class="{'active': open}">
                <a href="{{ url_for('index') }}" class="nav-link" @click="open = false">Home</a>
                <a href="{{ url_for('about') }}" class="nav-link" @click="open = false">About</a>
                <a href="{{ url_for('services') }}" class="nav-link" @click="open = false">Services</a>
                <a href="{{ url_for('portfolio') }}" class="nav-link" @click="open = false">Portfolio</a>
                <a href="{{ url_for('contact') }}" class="nav-link" @click="open = false">Contact</a>
                {% if current_user.is_authenticated %}
                <a href="{{ url_for('admin_dashboard') }}" class="btn admin-btn" @click="open = false">Dashboard</a>
                <a href="{{ url_for('admin_logout') }}" class="btn logout-btn" @click="open = false">Logout</a>
                {% endif %}
            </div>

            <button class="menu-toggle" id="menuToggle" @click="open = !open" :aria-expanded="open.toString()" aria-controls="navMenu" aria-label="Toggle navigation menu">
                <i class="fas" :class="open ? 'fa-times' : 'fa-bars'"></i>
            </button>
        </div>
    </nav>
    {% endif %}

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages">
                {% for category, message in messages %}
                    <div class="flash flash-{{ category }} fade-in-right">
                        <div class="flash-content">
                            <i class="fas fa-{% if category == 'success' %}check-circle{% elif category == 'error' %}exclamation-circle{% else %}info-circle{% endif %}"></i>
                            <span>{{ message }}</span>
                        </div>
                        <button class="flash-close" aria-label="Close message">&times;</button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Main Content -->
    <div id="top"></div>
    <main role="main" aria-label="Main content" tabindex="-1" id="main-content">
        {% block content %}{% endblock %}
    </main>

    <!-- Sticky CTA Bar (homepage only, shows after 50% scroll, shows once) -->
    {% if request.path == '/' %}
    <div x-data="{ 
           show: false,
           hasShown: false,
           init() {
             this.hasShown = localStorage.getItem('ctaBarShown') === 'true';
           },
           checkScroll() {
             if (this.hasShown) return;
             const scrollPercent = (window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
             if (scrollPercent >= 50 && !this.show) {
               this.show = true;
               this.hasShown = true;
               localStorage.setItem('ctaBarShown', 'true');
             }
           }
         }" 
         @scroll.window="checkScroll()"
         x-show="show"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="translate-y-full opacity-0"
         x-transition:enter-end="translate-y-0 opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="translate-y-0 opacity-100"
         x-transition:leave-end="translate-y-full opacity-0"
         class="fixed bottom-0 left-0 right-0 z-50 bg-gradient-to-r from-primary via-purple-600 to-secondary shadow-2xl"
         style="display: none;">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between gap-4">
                <div class="flex items-center gap-3">
                    <i class="fas fa-rocket text-white text-2xl hidden md:block"></i>
                    <div>
                        <p class="text-white font-bold text-sm md:text-base">Ready to Transform Your Business?</p>
                        <p class="text-white/90 text-xs md:text-sm">Let's discuss your project today</p>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <a href="{{ url_for('contact') }}" class="px-6 py-3 bg-white text-primary font-bold rounded-lg hover:bg-gray-100 transition-all duration-300 hover:scale-105 shadow-lg text-sm md:text-base whitespace-nowrap">
                        Get Started
                    </a>
                    <button @click="show = false" class="text-white/80 hover:text-white transition-colors p-2" aria-label="Close banner">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Scroll to Top Button -->
    <button x-data="{ show: false }"
            @scroll.window="show = window.scrollY > 400"
            x-show="show"
            @click="window.scrollTo({ top: 0, behavior: 'smooth' })"
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 scale-0"
            x-transition:enter-end="opacity-100 scale-100"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="opacity-100 scale-100"
            x-transition:leave-end="opacity-0 scale-0"
            class="fixed bottom-24 right-6 z-40 w-14 h-14 bg-gradient-to-br from-primary to-secondary text-white rounded-full shadow-2xl hover:shadow-xl hover:scale-110 transition-all duration-300 flex items-center justify-center group"
            style="display: none;"
            aria-label="Scroll to top">
        <i class="fas fa-arrow-up text-xl group-hover:-translate-y-1 transition-transform duration-300"></i>
    </button>

    <!-- Only show main site footer on non-admin pages -->
    {% if not request.path.startswith('/admin') %}
    <!-- Modern Footer -->
    <footer class="relative bg-[#050508] text-gray-100 noise-overlay">
        <!-- Gradient accent top border -->
        <div class="separator-gradient"></div>
        
        <div class="relative container mx-auto px-4 py-16 lg:py-20">
            <!-- Main Footer Grid -->
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-12 lg:gap-8 mb-12 pb-12 border-b border-white/10">
                
                <!-- Brand Column -->
                <div class="lg:col-span-1 space-y-4">
                    <p class="text-gray-400 text-sm leading-relaxed">Transforming businesses with precision and excellence.</p>
                    
                    <!-- Contact Info -->
                    <div class="space-y-2 pt-4">
                        <a href="mailto:info@thuwalaco.com" class="flex items-center gap-2 text-gray-300 hover:text-primary transition-colors duration-300 text-sm">
                            <i class="fas fa-envelope text-primary"></i>
                            <span>info@thuwalaco.com</span>
                        </a>
                        <a href="tel:+265887873006" class="flex items-center gap-2 text-gray-300 hover:text-primary transition-colors duration-300 text-sm">
                            <i class="fas fa-phone text-primary"></i>
                            <span>+265 887 580 622</span>
                        </a>
                        <div class="flex items-center gap-2 text-gray-300 text-sm pt-1">
                            <i class="fas fa-map-marker-alt text-primary"></i>
                            <span>Malawi & Beyond</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Links -->
                <div>
                    <h4 class="text-primary font-bold text-lg mb-6 flex items-center gap-2">
                        <span class="w-1 h-6 bg-primary rounded-full"></span>
                        Quick Links
                    </h4>
                    <ul class="space-y-3">
                        <li><a href="{{ url_for('index') }}" class="text-gray-300 hover:text-primary transition-colors duration-300 flex items-center gap-2"><i class="fas fa-home text-primary/50"></i> Home</a></li>
                        <li><a href="{{ url_for('services') }}" class="text-gray-300 hover:text-primary transition-colors duration-300 flex items-center gap-2"><i class="fas fa-rocket text-primary/50"></i> Services</a></li>
                        <li><a href="{{ url_for('portfolio') }}" class="text-gray-300 hover:text-primary transition-colors duration-300 flex items-center gap-2"><i class="fas fa-briefcase text-primary/50"></i> Portfolio</a></li>
                        <li><a href="{{ url_for('about') }}" class="text-gray-300 hover:text-primary transition-colors duration-300 flex items-center gap-2"><i class="fas fa-users text-primary/50"></i> About Us</a></li>
                        <li><a href="{{ url_for('contact') }}" class="text-gray-300 hover:text-primary transition-colors duration-300 flex items-center gap-2"><i class="fas fa-envelope text-primary/50"></i> Contact</a></li>
                    </ul>
                </div>

                <!-- Services Links -->
                <div>
                    <h4 class="text-primary font-bold text-lg mb-6 flex items-center gap-2">
                        <span class="w-1 h-6 bg-secondary rounded-full"></span>
                        Services
                    </h4>
                    <ul class="space-y-3">
                        <li><a href="{{ url_for('services') }}#consulting" class="text-gray-300 hover:text-secondary transition-colors duration-300 flex items-center gap-2"><i class="fas fa-chart-line text-secondary/50"></i> Business Consulting</a></li>
                        <li><a href="{{ url_for('services') }}#analytics" class="text-gray-300 hover:text-secondary transition-colors duration-300 flex items-center gap-2"><i class="fas fa-database text-secondary/50"></i> Data Analytics</a></li>
                        <li><a href="{{ url_for('services') }}#development" class="text-gray-300 hover:text-secondary transition-colors duration-300 flex items-center gap-2"><i class="fas fa-code text-secondary/50"></i> Development</a></li>
                        <li><a href="{{ url_for('services') }}#strategy" class="text-gray-300 hover:text-secondary transition-colors duration-300 flex items-center gap-2"><i class="fas fa-chess text-secondary/50"></i> Digital Strategy</a></li>
                        <li><a href="{{ url_for('services') }}#training" class="text-gray-300 hover:text-secondary transition-colors duration-300 flex items-center gap-2"><i class="fas fa-graduation-cap text-secondary/50"></i> Training</a></li>
                    </ul>
                </div>

                <!-- Newsletter & Social -->
                <div>
                    <h4 class="text-primary font-bold text-lg mb-6">Stay Connected</h4>
                    
                    <!-- Social Links -->
                    <div class="space-y-3 mb-8">
                        <p class="text-gray-400 text-sm">Follow us on social media</p>
                        <div class="flex gap-3">
                            <a href="#" aria-label="Facebook" class="w-10 h-10 rounded-lg bg-primary/10 hover:bg-primary flex items-center justify-center transition-all duration-300 hover:-translate-y-1">
                                <i class="fab fa-facebook-f text-primary"></i>
                            </a>
                            <a href="#" aria-label="LinkedIn" class="w-10 h-10 rounded-lg bg-primary/10 hover:bg-primary flex items-center justify-center transition-all duration-300 hover:-translate-y-1">
                                <i class="fab fa-linkedin-in text-primary"></i>
                            </a>
                            <a href="#" aria-label="Twitter" class="w-10 h-10 rounded-lg bg-primary/10 hover:bg-primary flex items-center justify-center transition-all duration-300 hover:-translate-y-1">
                                <i class="fab fa-twitter text-primary"></i>
                            </a>
                            <a href="#" aria-label="Instagram" class="w-10 h-10 rounded-lg bg-primary/10 hover:bg-primary flex items-center justify-center transition-all duration-300 hover:-translate-y-1">
                                <i class="fab fa-instagram text-primary"></i>
                            </a>
                        </div>
                    </div>
                    
                    <!-- Newsletter -->
                    <form action="{{ url_for('contact') }}" method="POST" class="space-y-3" x-data="{ email: '', submitting: false }">
                        <input type="hidden" name="subject" value="Newsletter Subscription">
                        <input type="hidden" name="message" value="I would like to subscribe to your newsletter.">
                        <input type="email" name="email" x-model="email" placeholder="Your email" required class="w-full px-4 py-2.5 bg-gray-100 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:border-primary transition-colors duration-300">
                        <button type="submit" :disabled="submitting" class="w-full px-4 py-2.5 bg-gradient-to-r from-primary to-secondary text-white font-semibold rounded-lg hover:shadow-lg hover:-translate-y-0.5 transition-all duration-300 disabled:opacity-50">
                            <span x-show="!submitting">Subscribe <i class="fas fa-paper-plane ml-2"></i></span>
                            <span x-show="submitting">Subscribing...</span>
                        </button>
                        <p class="text-gray-500 text-xs">We respect your privacy. Unsubscribe anytime.</p>
                    </form>
                </div>
            </div>

            <!-- Footer Bottom -->
            <div class="grid md:grid-cols-3 gap-6 items-center text-center md:text-left pt-8">
                <!-- Copyright -->
                <div class="text-gray-400 text-sm">
                    &copy; <span id="current-year">{{ now.year if now else "2024" }}</span> Thuwala Co. All rights reserved.
                </div>

                <!-- Trust Badges -->
                <div class="flex flex-wrap justify-center md:justify-center gap-3">
                    <div class="inline-flex items-center gap-1 px-3 py-1 bg-primary/10 rounded-full text-xs text-gray-300">
                        <i class="fas fa-shield-alt text-primary text-xs"></i>
                        <span>Secure</span>
                    </div>
                    <div class="inline-flex items-center gap-1 px-3 py-1 bg-secondary/10 rounded-full text-xs text-gray-300">
                        <i class="fas fa-check-circle text-secondary text-xs"></i>
                        <span>Trusted</span>
                    </div>
                </div>

                <!-- Legal Links & Back to Top -->
                <div class="flex flex-col sm:flex-row justify-center md:justify-end items-center gap-4 text-sm">
                    <div class="flex items-center gap-3 text-gray-400">
                        <a href="#" class="hover:text-primary transition-colors duration-300">Privacy</a>
                        <span class="text-gray-500">&bull;</span>
                        <a href="#" class="hover:text-primary transition-colors duration-300">Terms</a>
                        <span class="text-gray-500">&bull;</span>
                        <a href="#" class="hover:text-primary transition-colors duration-300">Cookies</a>
                    </div>
                    <a href="#top" class="text-primary hover:text-secondary transition-colors duration-300 font-semibold flex items-center gap-1">
                        <i class="fas fa-arrow-up text-xs"></i> Top
                    </a>
                </div>
            </div>
        </div>
    </footer>
    {% endif %}


    <!-- ðŸš€ Modern JavaScript Libraries -->
    <!-- Alpine Components (must load before Alpine init) -->
    <script src="{{ url_for('static', filename='js/alpine-components.js') }}"></script>
    <!-- Alpine.js 3.x - Lightweight reactive framework -->
    <script src="https://unpkg.com/alpinejs@3.13.3/dist/cdn.min.js"></script>
    
    <!-- GSAP - Premium animation library with ScrollTrigger -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.4/gsap.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.4/ScrollTrigger.min.js" defer></script>
    
    <!-- Splide.js - Modern carousel -->
    <script src="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/js/splide.min.js" defer></script>
    
    <!-- Custom JavaScript Files -->
    
    <!-- DEPRECATED: Old Admin JS - Replaced by Alpine.js + Tailwind approach -->
    <!-- These scripts are kept for reference but disabled to prevent conflicts -->
    <!-- Enable only if legacy admin pages still need them (before modernization) -->
    <!--
    {% if request.path.startswith('/admin') %}
    <script src="{{ url_for('static', filename='js/admin.js') }}"></script>
    <script src="{{ url_for('static', filename='js/admin-enhancements.js') }}" defer></script>
    {% endif %}
    -->
    
    <!-- Initialize GSAP ScrollTrigger and auto-inject CSRF tokens -->
    <script>
      // Navbar scroll effect
      (function() {
        var navbar = document.querySelector('.navbar');
        if (!navbar) return;
        function checkScroll() {
          if (window.scrollY > 50) {
            navbar.classList.add('navbar-scrolled');
          } else {
            navbar.classList.remove('navbar-scrolled');
          }
        }
        window.addEventListener('scroll', checkScroll, { passive: true });
        checkScroll();
      })();

      // Initialize GSAP ScrollTrigger animations
      document.addEventListener('DOMContentLoaded', function() {
        if (typeof gsap !== 'undefined' && typeof ScrollTrigger !== 'undefined') {
          gsap.registerPlugin(ScrollTrigger);
          
          // Fade in elements on scroll
          gsap.utils.toArray('.gsap-fade-in').forEach(function(elem) {
            gsap.fromTo(elem, 
              { opacity: 0, y: 50 },
              {
                opacity: 1,
                y: 0,
                duration: 0.8,
                ease: 'power2.out',
                scrollTrigger: {
                  trigger: elem,
                  start: 'top 85%',
                  toggleActions: 'play none none none'
                }
              }
            );
          });
          
          // Scale cards on scroll
          gsap.utils.toArray('.gsap-scale-card').forEach(function(elem) {
            gsap.fromTo(elem,
              { opacity: 0, scale: 0.9 },
              {
                opacity: 1,
                scale: 1,
                duration: 0.6,
                ease: 'back.out(1.2)',
                scrollTrigger: {
                  trigger: elem,
                  start: 'top 85%',
                  toggleActions: 'play none none none'
                }
              }
            );
          });
          
          // Stagger grid items
          gsap.utils.toArray('.gsap-stagger-grid').forEach(function(grid) {
            var items = grid.querySelectorAll('.grid-item');
            gsap.fromTo(items,
              { opacity: 0, y: 30 },
              {
                opacity: 1,
                y: 0,
                duration: 0.5,
                stagger: 0.1,
                ease: 'power2.out',
                scrollTrigger: {
                  trigger: grid,
                  start: 'top 85%',
                  toggleActions: 'play none none none'
                }
              }
            );
          });
        }
      });
      // Admin sidebar mobile toggle
      (function() {
        var btn = document.querySelector('button.fixed.lg\\:hidden');
        var aside = document.querySelector('aside.fixed');
        if (!btn || !aside) return;
        // Create overlay backdrop
        var overlay = document.createElement('div');
        overlay.className = 'fixed inset-0 bg-black/50 z-30 hidden';
        overlay.id = 'sidebarOverlay';
        aside.parentNode.insertBefore(overlay, aside);
        // Ensure sidebar slides in from left on mobile
        aside.style.transition = 'transform 0.3s ease';
        if (window.innerWidth < 1024) {
          aside.classList.remove('hidden');
          aside.style.transform = 'translateX(-100%)';
          aside.style.display = 'flex';
        }
        function openSidebar() {
          aside.classList.remove('hidden');
          aside.style.display = 'flex';
          aside.style.transform = 'translateX(0)';
          overlay.classList.remove('hidden');
          btn.querySelector('i').className = 'fas fa-times';
        }
        function closeSidebar() {
          aside.style.transform = 'translateX(-100%)';
          overlay.classList.add('hidden');
          btn.querySelector('i').className = 'fas fa-bars';
        }
        var sidebarOpen = false;
        btn.addEventListener('click', function() {
          sidebarOpen = !sidebarOpen;
          sidebarOpen ? openSidebar() : closeSidebar();
        });
        overlay.addEventListener('click', function() {
          sidebarOpen = false;
          closeSidebar();
        });
        // Keep sidebar visible on desktop resize
        window.addEventListener('resize', function() {
          if (window.innerWidth >= 1024) {
            aside.classList.remove('hidden');
            aside.style.transform = '';
            aside.style.display = '';
            overlay.classList.add('hidden');
            sidebarOpen = false;
          } else if (!sidebarOpen) {
            aside.style.transform = 'translateX(-100%)';
            aside.style.display = 'flex';
          }
        });
      })();

      // Auto-inject CSRF tokens into all POST/PUT/DELETE forms
      (function() {
        var meta = document.querySelector('meta[name="csrf-token"]');
        if (!meta) return;
        var token = meta.getAttribute('content');
        function inject(form) {
          if (form.method && form.method.toUpperCase() !== 'GET' && !form.querySelector('input[name="csrf_token"]')) {
            var inp = document.createElement('input');
            inp.type = 'hidden'; inp.name = 'csrf_token'; inp.value = token;
            form.appendChild(inp);
          }
        }
        document.querySelectorAll('form').forEach(inject);
        new MutationObserver(function(muts) {
          muts.forEach(function(m) {
            m.addedNodes.forEach(function(n) {
              if (n.nodeType === 1) {
                if (n.tagName === 'FORM') inject(n);
                if (n.querySelectorAll) n.querySelectorAll('form').forEach(inject);
              }
            });
          });
        }).observe(document.body, { childList: true, subtree: true });
      })();
    </script>
    
    {% block scripts %}{% endblock %}
</body>
</html>